<html>
<style>
    #immediate{
        height:200px;
        border-bottom:1px solid #444;
        padding:10px;
        overflow:auto;
    }
</style>
<body>
	<h1>Tests</h1>
	<div id="immediate"></div>

	<h2>InvokeTo(expression,...)</h2>
	<p>
		This examples shows how to use state-full ThorIO.Controller and targt Connection ( clients ) based on thier state.
	</p>
	Text:<input type="text" id="chat-message">Age:<input type="number" min="1" max="99" value="1" id="chat-age">
	<hr>
	<h2>Messages</h2>
	<div id="chatMessages"></div>

	<hr>
	<h2>PubSub</h2>
	<p>
		Subscribe /Unsubscribe to the topic 'foo'.
	</p>
	<div>
		<button id="subscribe">Subscribe 'foo'</button>
		<button id="unsubscribe">UnSubscribe 'foo'</button>
		<button id="publish">Send 'getFoo'</button>

	</div>
	<div id="pubsubMessages">

	</div>

    <hr>

        <h2>Widcard / RegEx based Invokes</h2>
        <p>
            <button id="regExInvoke">
                RegExp/Wildcard Invoke
            </button>
            </p>
            <div id="regExResponse"></div>



	<script src="/src/client/thor-io.client.js">
    </script>
	<script>

        var showMessage = function(text)
        {
            var p = document.createElement("p");
            p.textContent = text;
            document.querySelector("#chatMessages").appendChild(p);
        }

        var log = function(data){
             var p = document.createElement("p");
            p.textContent = JSON.stringify(data);
             document.querySelector("#immediate").appendChild(p);
        }

      
        var age = 1;
        document.addEventListener("DOMContentLoaded", function() {
            // ws://localhost:1337
            var client = new ThorIO.Client.Factory(location.origin.replace(/^http/, 'ws'), ["chat"], {});

            client.OnOpen = function(chat) {

                // state-full Controller using Invoke (RPC)
                document.querySelector("#chat-age").addEventListener("change", function()
                {
                        age = parseInt(this.value);
                        chat.SetProperty("age",age);

                });
                document.querySelector("#chat-message").addEventListener("keyup", function(evt)
                {
                    if(evt.keyCode === 13){
                        chat.Invoke("sendChatMessage",{
                            age: age,
                            message : this.value
                        },"chat")
                        this.value = "";
                    }
                }
                );

                 chat.On("chatMessage", function(data) {
                        showMessage(data.message);
                })



                // PubSub example

                document.querySelector("#subscribe").addEventListener("click", function()
                {
                        chat.Subscribe("foo", function(data){
                                log(data);
                        });
                        log("Now subscribing to 'foo'")
                });

                document.querySelector("#unsubscribe").addEventListener("click", function()
                {
                        chat.Unsubscribe("foo");
                        log("unsubscribed to 'foo'")
                });

                 document.querySelector("#publish").addEventListener("click", function()
                {
                        chat.Invoke("getFoo",{messge:'hello world!',timeStamp: new Date()});
                        
                });
              

              // RegExp/Wildcard


              document.querySelector("#regExInvoke").addEventListener("click",function(){
                    chat.Invoke("regExInvoke/1/2",{});
                    log("regExInvoke/1/2");
              });

                log("connected to 'chat 'Controller");

               
                chat.Connect();
            };
        });
    </script>

</body>

</html>