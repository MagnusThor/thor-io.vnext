<html>

<body>

    <script src="/src/client/thor-io.client.js">
    </script>
    <script>
        var bm, factory, _;

        function randomString(len, charSet) {
            charSet = charSet || 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
            var randomString = '';
            for (var i = 0; i < len; i++) {
                var randomPoz = Math.floor(Math.random() * charSet.length);
                randomString += charSet.substring(randomPoz, randomPoz + 1);
            }
            return randomString;
        }


        document.addEventListener("DOMContentLoaded", function() {


            factory = new ThorIO.Client.Factory(location.origin.replace(/^http/, 'ws'), ["chat"]);

            factory.OnOpen = function(chatProxy) {
                _ = chatProxy;
                console.log("chatProxy ->", chatProxy)


                chatProxy.On("fileShare",function(meta,blob){
                        console.log("fileShare ->",meta,blob);
                });

                chatProxy.Connect();

                chatProxy.OnError = function(err) {
                    console.log(err);
                }

            };



            bm = new ThorIO.Client.BinaryMessage(
                new ThorIO.Client.Message("fileShare", {
                    fileSize: 100,
                    fileName: "Roald Dahl",
                    fileDescription: randomString(256)
                }, "chat").toString(),
                new ArrayBuffer(100))
        });
    </script>
</body>

</html>