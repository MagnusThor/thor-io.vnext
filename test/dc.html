<html>

<body>
    <script src="adapter.js">
    </script>
    <script src="/src/client/thor-io.client.js">
    </script>


    <script>
        var $ = function(selector, el) {
            if (!el) el = document;
            return el.querySelector(selector);
        }


        var rtc, dc;
        document.addEventListener("DOMContentLoaded", function() {
            var client = new ThorIO.Client.Factory(location.origin.replace(/^http/, 'ws'), ["broker"]);
            client.OnOpen = function(brokerProxy) {

                rtc = new ThorIO.Client.WebRTC(brokerProxy, {
                    iceServers: [{
                            url: "stun:stun.l.google.com:19302"
                        }
                    ]

                });

                dc = rtc.createDataChannel("foo")

                dc.OnOpen = function() {
                    console.log("open");
                };

                dc.OnClose = function() {
                    console.log("close");
                };


                dc.On("bar", function(m) {
                    console.log("got a message on a channel", m);
                })

                rtc.onContextChanged = function(data) {
                    console.log("onContextChanged", data);
                    rtc.connectContext()
                };

                rtc.onContextCreated = function(data) {
                    console.log("onContextCreated", data);
                    rtc.changeContext("foo");
                };
                rtc.onConnectTo = function(peers) {
                    console.log("onConnectTo", peers);
                    rtc.connect(peers);
                };

                brokerProxy.Connect();
            };
        });
    </script>

</body>

</html>